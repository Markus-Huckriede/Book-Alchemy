<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Book Alchemy</title>
</head>
<body>
<h1>Book Alchemy</h1>

<!-- Flash messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <ul>
    {% for category, message in messages %}
      <li style="color: {% if category == 'success' %}green{% else %}red{% endif %};">
        {{ message }}
      </li>
    {% endfor %}
    </ul>
  {% endif %}
{% endwith %}

<!-- Buttons zu Add-Seiten -->
<p>
    <a href="{{ url_for('add_book') }}"><button>➕ Add Book</button></a>
    <a href="{{ url_for('add_author') }}"><button>➕ Add Author</button></a>
</p>

<!-- Search + Sort Form -->
<form method="GET" action="/">
    <input type="text" name="search" placeholder="Search" value="{{ search_query }}">
    <select name="search_field">
        <option value="title" {% if search_field == 'title' %}selected{% endif %}>Title</option>
        <option value="author" {% if search_field == 'author' %}selected{% endif %}>Author</option>
    </select>

    <label for="sort">Sort by:</label>
    <select name="sort_by" onchange="this.form.submit()">
        <option value="title" {% if sort_by == 'title' %}selected{% endif %}>Title</option>
        <option value="author" {% if sort_by == 'author' %}selected{% endif %}>Author</option>
    </select>

    <button type="submit">Search</button>
</form>

<!-- Books List -->
<ul>
{% if books %}
    {% for book in books %}
        <li>
            <strong><a href="{{ url_for('book_detail', book_id=book.id) }}">{{ book.title }}</a></strong> by
            <a href="{{ url_for('author_detail', author_id=book.author.id) }}">{{ book.author.name }}</a>
            {% if book.publication_year %} ({{ book.publication_year }}) {% endif %}
            {% if book.rating %} - Rating: {{ book.rating }}/10 {% endif %}

            <!-- Delete Book Button -->
            <form method="POST" action="{{ url_for('delete_book', book_id=book.id) }}" style="display:inline;">
                <button type="submit" onclick="return confirm('Are you sure you want to delete this book?');">
                    Delete Book
                </button>
            </form>
        </li>
    {% endfor %}
{% else %}
    <li>No books found.</li>
{% endif %}
</ul>

<!-- Book Cover -->
{% for book in books %}
  <div>
    <img src="{{ book.cover_url or url_for('static', filename='default_cover.jpg') }}"
         alt="{{ book.title }} cover"
         width="100">
    <p>{{ book.title }} by {{ book.author.name }}</p>
  </div>
{% endfor %}

<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 20px;">
{% if books %}
    {% for book in books %}
        <div style="border: 1px solid #ddd; padding: 10px; text-align: center;">
            <a href="{{ url_for('book_detail', book_id=book.id) }}">
                <img src="{{ book.cover_url or url_for('static', filename='default_cover.jpg') }}"
                     alt="{{ book.title }} cover"
                     style="width:100px; height:auto; margin-bottom: 10px;">
            </a>
            <p><strong>{{ book.title }}</strong></p>
            <p>by <a href="{{ url_for('author_detail', author_id=book.author.id) }}">{{ book.author.name }}</a></p>
            {% if book.publication_year %}<p>({{ book.publication_year }})</p>{% endif %}
            {% if book.rating %}<p>Rating: {{ book.rating }}/10</p>{% endif %}

            <!-- Delete Book Button -->
            <form method="POST" action="{{ url_for('delete_book', book_id=book.id) }}">
                <button type="submit" onclick="return confirm('Are you sure you want to delete this book?');">
                    Delete
                </button>
            </form>
        </div>
    {% endfor %}
{% else %}
    <p>No books found.</p>
{% endif %}
</div>

</body>
</html>
